<!DOCTYPE html>
<html>
<head><title>Results</title></head>
<body>
<h1>Analysis Results</h1>
{% if csv_filename %}
<p><strong>Uploaded CSV:</strong> {{ csv_filename }}</p>
{% endif %}
<pre>{{ analysis }}</pre>
<h2>Generated Sequence: {{ sequence.numbers }} BB: {{ sequence.bb }} Letter: {{ sequence.letter }}</h2>
<h2>Generated SUP6 Sequence: {% if sequence.sup6 %}{{ sequence.sup6.numbers }} Letter: {{ sequence.sup6.letter }}{% else %}No SUP6 prediction available{% endif %}</h2>

<h3>Last Uploaded Draws</h3>
{% if last_nla %}
<p><strong>Last NLA:</strong> {{ last_nla }}</p>
{% else %}
<p>No NLA draws uploaded yet.</p>
{% endif %}
{% if last_sup6 %}
<p><strong>Last SUP6:</strong> {{ last_sup6 }}</p>
{% else %}
<p>No SUP6 draws uploaded yet.</p>
{% endif %}

<h3>Dataset Totals</h3>
<p><strong>Total NLA Draws:</strong> {{ total_nla }}</p>
<p><strong>Total SUP6 Draws:</strong> {{ total_sup6 }}</p>

    <h3>Add New NLA Numbers to Recalibrate Predictions</h3>
    <form action="/add_nla" method="POST">
        <label for="draw_nla">Draw (e.g., 3463):</label><br>
        <input type="text" id="draw_nla" name="draw" pattern="\d+" required><br><br>
        <label for="nla">NLA (5 numbers, e.g., 01-02-03-04-05):</label><br>
        <input type="text" id="nla" name="nla" pattern="\d{2}-\d{2}-\d{2}-\d{2}-\d{2}" required><br><br>
        <label for="bb">BB (e.g., 29):</label><br>
        <input type="text" id="bb" name="bb" pattern="\d+" required><br><br>
        <label for="letter">Letter (e.g., K):</label><br>
        <input type="text" id="letter" name="letter" pattern="[A-Z]" maxlength="1" required><br><br>
        <input type="submit" value="Add NLA and Recalibrate">
    </form>

    <h3>Add New SUP6 Numbers to Recalibrate Predictions</h3>
    <form action="/add_sup6" method="POST">
        <label for="draw_sup6">Draw# (e.g., 2548):</label><br>
        <input type="text" id="draw_sup6" name="draw_num" pattern="\d+" required><br><br>
        <label for="sup6">SUP6 (6 numbers and letter, e.g., 13 16 20 21 22 28 J):</label><br>
        <input type="text" id="sup6" name="sup6" pattern="[\d\s]+[A-Z]?" required><br><br>
        <input type="submit" value="Add SUP6 and Recalibrate">
    </form>

    <br>
    <button onclick="regenerateNLA()">Regenerate NLA Prediction</button>
    <button onclick="regenerateSUP6()">Regenerate SUP6 Prediction</button>
    <br><br>
    <a href="{{ url_for('search') }}"><button>Search by Draw Number</button></a>
    <a href="{{ url_for('history') }}"><button>View Prediction History</button></a>
    <a href="{{ url_for('index') }}"><button>Return Home</button></a>
    <button onclick="showExitModal()">Exit Application</button>

    <!-- Exit Modal -->
    <div id="exitModal" style="display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
        <div style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 400px;">
            <h2>Exit Application</h2>
            <p>You have unsaved changes. Do you want to save your data before exiting?</p>
            <button onclick="saveAndExit()">Save and Exit</button>
            <button onclick="exitWithoutSave()">Exit without Save</button>
            <button onclick="cancelExit()">Cancel</button>
        </div>
    </div>

    <script>
        function regenerateNLA() {
            fetch('/regenerate_nla', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    document.querySelector('h2').innerText = 'Generated Sequence: ' + data.numbers + ' BB: ' + data.bb + ' Letter: ' + data.letter;
                });
        }

        function regenerateSUP6() {
            fetch('/regenerate_sup6', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.sup6) {
                        document.querySelectorAll('h2')[1].innerText = 'Generated SUP6 Sequence: ' + data.sup6.numbers + ' BB: ' + data.sup6.bb + ' Letter: ' + data.sup6.letter;
                    }
                });
        }

        function showExitModal() {
            document.getElementById('exitModal').style.display = 'block';
        }

        function saveAndExit() {
            fetch('/save', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        window.location.href = '/exit';
                    } else {
                        alert('Error saving data: ' + data.message);
                    }
                });
        }

        function exitWithoutSave() {
            window.location.href = '/exit';
        }

        function cancelExit() {
            document.getElementById('exitModal').style.display = 'none';
        }
    </script>
</body>
</html>
